(function(b){b.PeriodicalUpdater=function(n,m,q){m||(m={});var a=jQuery.extend(!0,{url:n,cache:!1,method:"GET",data:"",minTimeout:1E3,maxTimeout:64E3,multiplier:2,maxCalls:0,maxCallsCallback:null,autoStop:0,autoStopCallback:null,cookie:!1,runatonce:!1,verbose:0},m),d=function(b,c){if(a.verbose>=(c||1))try{console.log(b)}catch(d){}},v=null,k=null,r=null,e=a.minTimeout,f=a.maxCalls,x=a.autoStop,t=0,p=0,y=f,g=function(l){b(function(){null!==v&&clearTimeout(v);e=l;d("resetting timer to "+e+".",2);a.cookie&&
b.cookie&&b.cookie(a.cookie.name,e,a.cookie);v=setTimeout(w,e)})};a.cookie&&("boolean"==typeof a.cookie?a.cookie={name:n}:"object"!=typeof a.cookie&&(a.cookie={name:a.cookie.toString()}),a.cookie.name||(a.cookie.name=n),b.cookie?b.cookie(a.cookie.name)&&g(b.cookie(a.cookie.name)):b.getScript("//rawgit.com/carhartl/jquery-cookie/master/jquery.cookie.js",function(){d("Loaded the cookies handler script",2);b.cookie(a.cookie.name)?(d("Not runatonce and have cookie value",2),g(b.cookie(a.cookie.name))):
(d("Not runatonce, but no cookie value",2),g(e))}).fail(function(){d("Could not load the cookies handler script",1);g(e)}));var h=jQuery.extend(!0,{},a);a.type&&!h.dataType&&(h.dataType=a.type);a.sendData&&(h.data=a.sendData);h.type=a.method;h.ifModified=!0;var w=function(l){var c=jQuery.extend(!0,{},h);"function"==typeof m.data&&(c.data=m.data());c.data&&"number"==typeof c.data&&(c.data=c.data.toString());l||0===f?(d("Sending data"),b(function(){b.ajax(c)})):0<f&&t<f?(d("Sending data because we are at "+
t+" of "+f+" calls"),b(function(){b.ajax(c)}),t++):-1==f?d("NOT sending data: stop has been called",1):(d("NOT sending data: maximum number of calls reached - "+f,1),a.maxCallsCallback&&a.maxCallsCallback())},u={boostTimer:function(a){0<a&&1!=a?(d("Boosting timer by a factor of "+a),e*=a):d("Cannot boost timer by a factor of "+a);g(e)},restart:function(a){d("Calling restart");f=y;p=t=0;g(a||e)},send:function(){d("Explicit call to send");w(!0)},stop:function(){d("Calling stop");f=-1;a.cookie&&b.cookie&&
b.cookie(a.cookie.name,null,a.cookie)}};h.success=function(a){d("Successful run! (In 'success')",2);k=a};h.complete=function(l,c){d("Status of call: "+c+" (In 'complete')",2);if("success"==c||"notmodified"==c){var f=b.trim(l.responseText);if(r==f){if(0<x&&(p++,p==x)){u.stop();a.autoStopCallback&&a.autoStopCallback(p);return}1<a.multiplier&&(f=e,e*=a.multiplier,e>a.maxTimeout&&(e=a.maxTimeout),d("adjusting timer from "+f+" to "+e+".",2));g(e)}else p=0,g(a.minTimeout),r=f,a.cookie&&b.cookie(a.cookie.name,
r,a.cookie),null===k&&(k=f),"json"===h.dataType&&"string"===typeof k&&"success"==c&&(k=JSON.parse(k)),a.success&&a.success(k,c,l,u),q&&q(k,c,l,u)}a.complete&&a.complete(l,c);k=null};h.error=function(e,c){d("Error message: "+c+" (In 'error')",2);"notmodified"!=c&&(r=null,a.cookie&&b.cookie(a.cookie.name,null,a.cookie),g(a.minTimeout));a.error&&a.error(e,c)};a.runatonce?(d("Executing a call immediately",1),w(!0)):b.cookie&&a.cookie&&b.cookie(a.cookie.name)||(d("Enqueing a the call for after "+e,1),
g(e));return u};b.fn.PeriodicalUpdater=function(n,m,q){var a=this;return b.PeriodicalUpdater(n,m,function(){return q.apply(a,arguments)})}})(jQuery);